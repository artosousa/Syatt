import{deepMerge,scrollLock}from"helpers";class WYATTElement extends HTMLElement{constructor(e){super(),this.config=this.getComponentConfig(e),this.unsubscribers=[]}disconnectedCallback(){this.unsubscribers.length&&this.unsubscribers.forEach((e=>e()))}getComponentConfig(e){const s=e||{},t=this.querySelector("[data-config]")?.textContent,i=t?JSON.parse(t):{},o=Math.random().toString(16).slice(2);return deepMerge({id:o},s,i)}publish(e,s){WYATT.config.pubsub.subscribers[e]&&WYATT.config.pubsub.subscribers[e].forEach((e=>{e(s)}))}subscribe(e,s){void 0===WYATT.config.pubsub.subscribers[e]&&(WYATT.config.pubsub.subscribers[e]=[]),WYATT.config.pubsub.subscribers[e]=[...WYATT.config.pubsub.subscribers[e],s],this.unsubscribers.push((()=>{WYATT.config.pubsub.subscribers[e]=WYATT.config.pubsub.subscribers[e].filter((e=>e!==s))}))}}class WYATTDialog extends WYATTElement{constructor(){super(),this.openButton=this.querySelector("[data-open]"),this.dialog=this.getDialog(),this.wrapper=this.dialog.querySelector("[data-wrapper]"),this.openButton.addEventListener("click",this.open.bind(this)),this.openButton.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),this.open())})),this.handleClickOutside(),this.dialog.addEventListener("close",this.close.bind(this)),this.config.openOn&&this.config.openOn.forEach((e=>this.subscribe(WYATT.config.pubsub.events[e],this.open.bind(this)))),this.config.closeOn&&this.config.closeOn.forEach((e=>this.subscribe(WYATT.config.pubsub.events[e],this.close.bind(this))))}connectedCallback(){document.body.append(this.dialog)}disconnectedCallback(){super.disconnectedCallback(),this.dialog.remove()}open(){this.dialog.showModal(),this.dialog.setAttribute("active",!0),scrollLock.enable()}close(){this.dialog.close(),this.dialog.setAttribute("active",!1),scrollLock.disable()}handleClickOutside(){this.dialog.addEventListener("click",(()=>{this.dialog.close()})),this.wrapper.addEventListener("click",(e=>{e.stopPropagation()}))}getDialog(){return this.querySelector("[data-dialog]")||document.querySelector(this.openButton.dataset.open)}}export{WYATTElement,WYATTDialog};